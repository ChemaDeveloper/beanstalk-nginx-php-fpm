## Install nginx and php71-fpm
packages:
  yum:
    nginx: []
    php71-fpm: []

## Update the Elasticbeanstalk environment and config files
commands:
  ## Make all .sh scripts executable
  001_sh_executable:
    command: find .ebextensions/setup/hooks/ -type f -iname "*.sh" -exec chmod +x {} \;
  ## Copy all custom platform scripts and config files
  010_hooks:
    command: cp -rf .ebextensions/setup/hooks/* /opt/elasticbeanstalk/hooks/
  020_support:
    command: cp -rf .ebextensions/setup/support/* /opt/elasticbeanstalk/support/
  030_tasks:
    command: cp -rf .ebextensions/setup/tasks/* /opt/elasticbeanstalk/tasks/
  ## Copy custom nginx and php-fpm config files
  040_nginx_conf:
    command: cp -f .ebextensions/setup/config/nginx/nginx.conf /etc/nginx/nginx.conf
  050_php_fpm_conf:
    command: cp -f .ebextensions/setup/config/php-fpm/php-fpm.conf /etc/php-fpm-7.1.conf
  060_www_pool_conf:
    command: cp -f .ebextensions/setup/config/php-fpm/www.conf /etc/php-fpm-7.1.d/www.conf

## Disable apache, enable nginx and php-fpm
services:
  httpd:
    enabled: false
    ensureRunning: false
    packages:
      yum:
        httpd24: []
  nginx:
    enabled: true
    ensureRunning: true
    packages:
      yum:
        nginx: []
  php-fpm:
    enabled: true
    ensureRunning: true
    packages:
      yum:
        php71-fpm: []
